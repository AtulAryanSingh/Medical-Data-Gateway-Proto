# DEMO — Running the Full Pipeline End-to-End

## Prerequisites

1. **Install dependencies**

   ```bash
   pip install -r requirements.txt
   ```

2. **Obtain sample DICOM data**

   The pipeline expects raw DICOM files inside a folder (default: `2_skull_ct/DICOM`).
   You can source free public DICOM files from:
   - [DICOM Standard Tools & Samples](https://www.dicomstandard.org/tools)
   - `pydicom`'s built-in test files: `python -c "import pydicom; print(pydicom.data.get_testfiles_name('CT_small.dcm'))"`

---

## Step-by-Step Run Guide

### Step 1 — Batch Anonymize & Upload (with resilient retry)

```bash
python batch_processor.py --input 2_skull_ct/DICOM --output batch_anonymized --limit 5
```

| Argument | Default | Description |
|---|---|---|
| `--input` | `2_skull_ct/DICOM` | Folder containing raw DICOM files |
| `--output` | `batch_anonymized` | Folder where anonymized files are saved |
| `--limit` | `5` | Maximum number of files to process (demo cap) |

**Expected output:** Anonymized DICOM files in `batch_anonymized/`, with simulated upload logs including exponential backoff retries.

---

### Step 2 — View an Anonymized Scan

```bash
python viewer.py --folder batch_anonymized --file Clean_I10.dcm
```

| Argument | Default | Description |
|---|---|---|
| `--folder` | `batch_anonymized` | Folder containing anonymized DICOM files |
| `--file` | `Clean_I10.dcm` | Specific file to display |

**Expected output:** A matplotlib window showing the CT slice with anonymized patient metadata printed to the console.

---

### Step 3 — Run AI Segmentation (density_plot.py)

```bash
python density_plot.py
```

This script auto-detects the first file in `batch_anonymized/` and runs K-Means clustering to segment Air, Soft Tissue, and Bone.

**Expected output file:** `highlighted_scan.png`

---

### Step 4 — Run Population Data Mining (miner.py)

```bash
python miner.py
```

This script aggregates features across all files in `batch_anonymized/` and groups them into clusters (normal vs. outlier scans).

**Expected output file:** `mining_report.png`

---

## Output Files Summary

| File | Generated by | Description |
|---|---|---|
| `batch_anonymized/Clean_*.dcm` | `batch_processor.py` | Anonymized DICOM files |
| `anonymized_scan.dcm` | `anonymizer.py` | Single-file anonymization result |
| `highlighted_scan.png` | `density_plot.py` | AI segmentation visualization |
| `mining_report.png` | `miner.py` | Population clustering scatter plot |
